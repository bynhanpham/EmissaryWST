var userState=JSON.parse(localStorage.getItem("userState"));userState||(location.href="login.html"),$(document).ready(function(){function t(t){var e=new Date;t=new Date(Date.parse(t));var a=t.getFullYear()+" "+t.getDate()+" "+t.getMonth(),n=e.getFullYear()+" "+e.getDate()+" "+e.getMonth();return a===n}function e(t){for(var e in n)if(n.hasOwnProperty(e)&&n[e]._id===t)return i&&console.log(n[e]),n[e]}function a(t){var e=new Date(Date.parse(t)),a=e.getHours(),n=e.getMinutes();return 10>n&&(n="0"+n),a>=13?(a-=12,e=a+":"+n+"PM"):e=12===a?a+":"+n+"PM":0===a?"1:"+n+"AM":a+":"+n+"AM",e}var n,o=io(),i=1,r="validate_company_id",l="visitor_list_update",s="remove_visitor",c=JSON.parse(localStorage.getItem("currentCompany"));c.company_id=c._id;var m=JSON.parse(localStorage.getItem("currentUser"));c.name;$("#user-name").text(m.first_name+" "+m.last_name),o.emit(r,c);var u=$("#visitor-list-template").html(),d=Handlebars.compile(u),p=$("#visitor-info-template").html(),v=Handlebars.compile(p);o.on(l,function(e){n=e.visitors;for(var o=0,i=n.length;i>o;o++)n[o].checkin_time=a(n[o].checkin_time);for(o=0;i>o;o++){var r=n[o].appointments;if(r[0]){for(var l=0,s=r.length;s>l;l++)if(t(r[l].date)){n[o].appointmentTime=a(r[l].date),n[o]._apptId=r[l]._id;break}}else n[o].appointmentTime="None"}var c=d(n);$("#visitor-list").html(c)}),$(document).on("click",".patient-check-out",function(){var t=$(this).attr("value"),a=e(t),n=v(a);$(".modal-dialog").html(n)}),$(document).on("click",".check-in-btn",function(){var t=$(this).closest(".modal-content").find(".modal-body").attr("value"),a=$(this).closest(".modal-content").find(".modal-left").attr("value"),n=e(t);n.visitor_id=n._id,$.ajax({dataType:"json",type:"DELETE",url:"/api/appointments/"+a,success:function(t){}}),o.emit(s,n)}),$("#logoutButton").on("click",function(){localStorage.setItem("userState",0)})});
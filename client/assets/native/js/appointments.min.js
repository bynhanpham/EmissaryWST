$(document).ready(function(){function t(t){t.sort(function(t,e){return new Date(t.date)-new Date(e.date)});for(var e=0,a=t.length;a>e;e++)t[e].fullDate=s(t[e].date.toString()),t[e].appointmentTime=l(t[e].date.toString());return t}function e(){var t;return $.ajax({dataType:"json",type:"GET",data:$("#response").serialize(),async:!1,url:"/api/appointments/company/"+c,success:function(e){t=e,console.log(e)}}),t}function a(){var a=r();console.log(a),n(a),d=e(),d=t(d),$("#appt-list").html(f(d)),document.getElementById("appt-form").reset()}function n(t){$.ajax({dataType:"json",type:"POST",data:t,async:!1,url:"/api/appointments/",success:function(t){d.push(t),console.log(t)}})}function r(){var t,e,a={};return a.company_id=c,a.first_name=$("#appt-first").val(),a.last_name=$("#appt-last").val(),a.phone_number=$("#appt-number").val(),a.provider_name=$("#appt-provider").val(),e=$("#appt-date").val(),t=$("#appt-time").val(),a.date=o(e,t),a}function s(t){var e=new Date(Date.parse(t)),a=e.getMonth()+1,n=e.getFullYear(),r=e.getDate();return 10>r&&(r="0"+r),10>a&&(a="0"+a),a+"/"+r+"/"+ +n}function o(t,e){var a=p(t),n=u(e);return jsDateObj=a+" "+n,jsDateObj}function p(t){var e=new Date(Date.parse(t)),a=e.getMonth()+1,n=e.getFullYear(),r=e.getDate();return 10>r&&(r="0"+r),10>a&&(a="0"+a),n+"-"+a+"-"+r}function u(t){var e,a,n=t.substr(-2,2),r=t.indexOf(":");return"PM"===n?(a=t.substr(0,2),a="12"===a?12:12+parseInt(t.substr(0,2),10),e=a+t.substr(r,3)+":00"):(a=parseInt(t.substr(0,2),10),10>a&&(a="0"+a),12===a&&(a="00"),e=a+t.substr(r,3)+":00"),e}function l(t){var e=new Date(Date.parse(t)),a=e.getHours(),n=e.getMinutes();return 10>n&&(n="0"+n),a>=13?(a-=12,e=a+":"+n+"PM"):e=12===a?a+":"+n+"PM":0===a?"1:"+n+"AM":a+":"+n+"AM",e}var i=JSON.parse(localStorage.getItem("currentCompany")),c=i._id,m=JSON.parse(localStorage.getItem("currentUser"));$("#user-name").text(m.first_name+" "+m.last_name);var d=e();d=t(d);var v=$("#appt-list-template").html(),f=Handlebars.compile(v),g=f(d);$("#appt-list").html(g),$(".save-btn").click(a),$(document).on("click",".delete-appt",function(){var a=$(this).closest(".appt-row").attr("value");console.log("delete"),$.ajax({dataType:"json",type:"DELETE",url:"/api/appointments/"+a,success:function(a){var n=e(),r=t(n);$("#appt-list").html(f(r))}})})});